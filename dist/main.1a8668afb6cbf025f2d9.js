!function(e){var t={};function i(s){if(t[s])return t[s].exports;var o=t[s]={i:s,l:!1,exports:{}};return e[s].call(o.exports,o,o.exports,i),o.l=!0,o.exports}i.m=e,i.c=t,i.d=function(e,t,s){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)i.d(s,o,function(t){return e[t]}.bind(null,o));return s},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=1)}([function(e,t,i){},function(e,t,i){"use strict";i.r(t);i(0);function s(){this._map,this._masterPlacesLayers={},this._masterBuildingsLayers=new L.LayerGroup,this.init()}s.prototype={init:function(){this._map=L.map("mapid",{zoomControl:!1}).setView([43.02825898949743,131.89296126365664],13).setMaxBounds([[43.050952,131.85915],[42.994509,131.94232]]),L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{minZoom:15,maxZoom:19,attribution:'&copy; <a href="https://openstreetmap.org/copyright">OpenStreetMap contributors</a>'}).addTo(this._map)},addPlacesLayers:function(e){e instanceof Array||(e=Object.values(e)),e.forEach(e=>{this.addPlacesLayer(e)})},addPlacesLayer:function(e){var t=L.geoJSON([],{onEachFeature:(e,t)=>{t._leaflet_id=e.properties.id,t.state="inactive",t.options.icon=L.icon({iconUrl:`/media/placesicons/${e.properties.icon||"default"}.svg`,iconSize:[20,20],iconAnchor:[10,10],popupAnchor:[0,0]}),t.setLatLng(e.geometry.coordinates),t.on("click",e=>{console.log("click on place")})}});this._masterPlacesLayers[e.id]=t,"active"===e.state&&t.addTo(this._map)},addPlaces:function(e,t){e instanceof Array||(e=Object.values(e)),e.forEach(e=>{this.addPlaces(e,t)})},addPlace:function(e,t){const i={type:"Feature",geometry:{type:"Point",coordinates:[e.latlng.lat,e.latlng.lng]},properties:{id:e.id,icon:e.icon||"default"}};this._masterPlacesLayer.getLayer(t).addData(i)},showLayer:function(e){const t=this._masterPlacesLayers[e];t&&!this._map.hasLayer(t)&&t.addTo(this._map)},hideLayer:function(e){const t=this._masterPlacesLayers[e];t&&this._map.hasLayer(t)&&this._map.removeLayer(t)}};var o=s;function a(){this.$layersSidebar=document.querySelector(".app #layers-sidebar")}a.prototype={renderLayerItem:function(e){const t=`\n            <div id="${e.id}" class="layer-checkbox">\n                <div class="layer-checkbox__btn ${"disable"===e.state?"layer-checkbox__btn--disabled":""} shadow">\n                    <img src="${e.icon}" alt="">\n                </div>\n                <span class="layer-checkbox__span">${e.title}</span>\n            </div>\n        `;this.$layersSidebar.querySelector(".sidebar__container").insertAdjacentHTML("beforeend",t)},addWrapper:function(){document.querySelector("body").insertAdjacentHTML("afterbegin",'<div class="wrapper"></div>')},removeWrapper:function(){document.querySelector("body").removeChild(document.querySelector(".wrapper"))},open:function(){this.$layersSidebar.classList.add("show")},close:function(){this.$layersSidebar.classList.remove("show")},toggleDisabling:function(e){this.$layersSidebar.querySelector("#"+e).querySelector(".layer-checkbox__btn").classList.toggle("layer-checkbox__btn--disabled")}};var n=a;function r(){this._listeners=[]}r.prototype={attach:function(e){this._listeners.push(e)},notify:function(...e){this._listeners.forEach(t=>{t(...e)})}};var c=r;function l(){this._state="close",this.view=new n,this.toggleLayerDisablingEvent=new c,this.enable()}l.prototype={enable:function(){this.view.$layersSidebar.addEventListener("click",e=>{const t=e.target.closest(".layer-checkbox");if(t){const e=t.querySelector(".layer-checkbox__btn");this.toggleLayerDisabling(t.id,e.classList.contains("layer-checkbox__btn--disabled"))}})},open:function(){this._state="open",this.view.open(),this.view.addWrapper(),document.querySelector(".wrapper").addEventListener("click",e=>{this.close()})},close:function(){"open"===this._state&&(this._state="close",this.view.close(),this.view.removeWrapper())},renderLayersItems:function(e){e instanceof Array||(e=Object.values(e)),e.forEach(e=>this.view.renderLayerItem(e))},toggleLayerDisabling:function(e,t){const i=t?"active":"disable";this.view.toggleDisabling(e),this.toggleLayerDisablingEvent.notify(e,i)}};var d=l,h=i.p+"325b3c1c2c72d5793f865fec04c8a825.svg";function u(){this.$messageBlock,this.$sendMessageBtn,this.$centeredMarker}u.prototype={renderMessageBlock:async function(){const e=`\n            <div class="message-block">\n                <div class="message-block__container">\n                    <div class="writable-message shadow">\n                        <div class="writable-message__text-field">\n                            <textarea name="mess" id="mess" onlyread="false" placeholder="Введите сообщение" maxlength="110" cols="30" rows="1"></textarea>\n                        </div>\n                        <div class="writable-message__send-btn">\n                            <img src="${h}" alt="">\n                        </div>\n                    </div>\n                </div>\n            </div>\n        `;await document.querySelector(".app .main .map-container").insertAdjacentHTML("beforeend",e),this.$messageBlock=document.querySelector(".message-block"),this.$sendMessageBtn=this.$messageBlock.querySelector(".writable-message__send-btn"),setTimeout(()=>{this.$messageBlock.classList.add("show"),this._showMarker()},100)},removeMessageBlock:function(){if(void 0!==this.$messageBlock)try{this.$messageBlock.classList.remove("show"),setTimeout(()=>{this.$messageBlock.parentNode.removeChild(this.$messageBlock),this.$messageBlock=void 0,this.$sendMessageBtn=void 0},300),this._hideMarker()}catch(e){console.error(e)}},getValuerFromInput:function(){return this.$messageBlock.querySelector("textarea").value},_showMarker:function(){this.$centeredMarker=document.querySelector(".centered-marker"),this.$centeredMarker.classList.add("show")},_hideMarker:function(){this.$centeredMarker.classList.remove("show"),this.$centeredMarker=void 0}};var p=u;var f=function(e,t){const i=function(){t(),document.removeEventListener(e,i)};document.addEventListener(e,i)};function y(e){this._state="close",this._cookieName="nextmsgsndg",this.notifications=e,this.view=new p}y.prototype={open:function(){"close"===this._state&&(this._state="open",this.notifications.clear(),this.view.renderMessageBlock().then(()=>{this._enable()}))},close:function(){"open"===this._state&&(this._state="close",this.view.removeMessageBlock())},_enable:function(){this.view.$messageBlock.addEventListener("click",e=>{e.stopPropagation()}),this.view.$sendMessageBtn.addEventListener("click",e=>{const t=this.view.getValuerFromInput();this._sendMessage(t)}),f("click",this.close.bind(this))},_sendMessage:function(e){const t=this._getCookie(this._cookieName);if(e.length>5&&void 0===t)this.close(),this._writeCookie(),this.notifications.notify("user-notification",e);else if(void 0!==t){var i=new Date(t)-(new Date).getTime();this.close(),this.notifications.notify("system-notification","Отправка сообщений будет доступна через: "+this._msToTime(i))}},_msToTime:function(e){parseInt(e%1e3/100);var t=Math.floor(e/1e3%60);return Math.floor(e/6e4%60)+"мин "+(t=t<10?"0"+t:t)+"с."},_writeCookie:function(){var e=new Date;e.setTime(e.getTime()+3e5);var t="; expires="+e.toUTCString();document.cookie=this._cookieName+"="+e+t+"; path=/"},_getCookie:function(e){const t=("; "+document.cookie).split(`; ${e}=`);if(2===t.length)return t.pop().split(";").shift()}};var m=y;const g=JSON.stringify({placesLayer_pe73zbwun:{id:"placesLayer_pe73zbwun",title:"Поесть",icon:"./media/layers/canteen.svg",places:{}},placesLayer_0bfeky7y6:{id:"placesLayer_0bfeky7y6",title:"Покупки",icon:"./media/layers/buy.svg",places:{}},placesLayer_7j2i7g4ca:{id:"placesLayer_7j2i7g4ca",title:"Банки и Банкоматы",icon:"./media/layers/credit-card.svg",places:{}},placesLayer_b821zcztt:{id:"placesLayer_b821zcztt",title:"Медицина",icon:"./media/layers/pharmacy.svg",places:{}},placesLayer_ncx52mogj:{id:"placesLayer_ncx52mogj",title:"Услуги",icon:"./media/layers/services.svg",places:{}},placesLayer_oanemea8a:{id:"placesLayer_oanemea8a",title:"Копировальные центры",icon:"./media/layers/printer.svg",places:{}}});function v(){this._placesLayers={},this._buildingsLayers={}}v.prototype={loadPlacesLayers:async function(){const e=await g;return this._placesLayers=await JSON.parse(e),this._placesLayers},loadBuildingsLayers:async function(){},getPlaceLayer:function(e){return this._placesLayers[e]},getPlacesLayers:function(){return this._placesLayers},getPlace:function(e,t){return this.getPlaceLayer(e)[t]},getBuilding:function(){}};var b=v;function _(){this.$footerToolbar=document.querySelector(".footer-toolbar"),this.$options=this.$footerToolbar.querySelectorAll(".navigation__item")}_.prototype={highlightSelected:function(e){this.$options.forEach(e=>e.classList.remove("active")),e.classList.add("active")},show:function(){this.$footerToolbar.classList.remove("hide")},hide:function(){this.$footerToolbar.classList.add("hide")}};var w=_;function k(){this.view=new w,this.selectOptionEvent=new c,this.enable()}k.prototype={enable:function(){this.view.$footerToolbar.addEventListener("click",e=>{e.stopPropagation();const t=e.target.closest(".navigation__item");t&&(this.selectItem(t.id),this.view.highlightSelected(t))})},selectItem:function(e){this.selectOptionEvent.notify(e)},show:function(){this.view.show()},hide:function(){this.view.hide()}};var S=k;function $(){this.$notificationsBlock=document.querySelector(".app .notifications")}$.prototype={renderNotification:function(e,t){const i=`\n            <div class="notification ${e}">${t}</div>    \n        `;this.$notificationsBlock.insertAdjacentHTML("beforeend",i)},clear:function(){Array.from(this.$notificationsBlock.querySelectorAll(".notification")).forEach(e=>{e.classList.add("hide"),setTimeout(()=>this.$notificationsBlock.removeChild(e),300)})}};var O=$;function T(){this.view=new O}T.prototype={notify:function(e,t){this.view.renderNotification(e,t),this._enable()},clear:function(){this.view.clear()},_enable:function(){f("click",this.clear.bind(this))}};var M=T;function P(){this._currentOption=void 0,this.map=new o,this.mapData=new b,this.notifications=new M,this.footerToolbar=new S,this.leftSidebar=new d,this.message=new m(this.notifications),this.mapData.loadPlacesLayers().then(e=>{this.renderPlacesLayers(e)}),this.setupHandlers().enable()}window.addEventListener("load",e=>{const t=document.querySelector(".preloader");t.classList.add("preloader--out"),setTimeout(()=>{t.parentElement.removeChild(t)},500)}),P.prototype={setupHandlers:function(){return this.toggleLayerVisibilityHandler=this.toggleLayerVisibility.bind(this),this.selectFooterToolbarOptionHandler=this.selectFooterToolbarOption.bind(this),this},enable:function(){return this.leftSidebar.toggleLayerDisablingEvent.attach(this.toggleLayerVisibilityHandler),this.footerToolbar.selectOptionEvent.attach(this.selectFooterToolbarOptionHandler),this},renderPlacesLayers:function(e){e instanceof Array||(e=Object.values(e));const t=JSON.parse(localStorage.getItem("layers"))||{};t!=={}?e.forEach(e=>{t.hasOwnProperty(e.id)?e.state=t[e.id]:(e.state="active",t[e.id]="active")}):e.forEach(e=>{e.state="active",t[e.id]="active"}),localStorage.removeItem("layers"),localStorage.setItem("layers",JSON.stringify(t)),this.leftSidebar.renderLayersItems(e),this.map.addPlacesLayers(e)},toggleLayerVisibility:function(e,t){const i=JSON.parse(localStorage.getItem("layers"));switch(i[e]=t,t){case"active":this.map.showLayer(e);break;case"disable":this.map.hideLayer(e)}localStorage.removeItem("layers"),localStorage.setItem("layers",JSON.stringify(i))},selectFooterToolbarOption:function(e){switch(e){case"layers_ctrl":this._selectOption(this.leftSidebar);break;case"pin_ctrl":this._selectOption(this.message)}},_selectOption:function(e){void 0!==this._currentOption&&this._currentOption!==e&&this._currentOption.close(),this._currentOption=e,this._currentOption.open()},showFooterToolbar:function(){this.footerToolbar.show()},hideFooterToolbar:function(){this.footerToolbar.hide()}},new P}]);