!function(e){var t={};function i(s){if(t[s])return t[s].exports;var a=t[s]={i:s,l:!1,exports:{}};return e[s].call(a.exports,a,a.exports,i),a.l=!0,a.exports}i.m=e,i.c=t,i.d=function(e,t,s){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)i.d(s,a,function(t){return e[t]}.bind(null,a));return s},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=7)}([function(e,t,i){"use strict";function s(){this._listeners=[]}s.prototype={attach:function(e){this._listeners.push(e)},notify:function(...e){this._listeners.forEach(t=>{t(...e)})}},t.a=s},function(e,t,i){"use strict";t.a=i.p+"./media/3251e2531d28b2aac088bb5a8efa06b6.svg"},function(e,t,i){},,,,,function(e,t,i){"use strict";i.r(t);i(2);L.ImageOverlay.Rotated=L.ImageOverlay.extend({initialize:function(e,t,i,s,a,n){this._map=e,"string"==typeof t?this._url=t:this._rawImage=t,this._topLeft=L.latLng(i),this._topRight=L.latLng(s),this._bottomLeft=L.latLng(a),L.setOptions(this,n)},onAdd:function(e){this._image||(this._initImage(),this.options.opacity<1&&this._updateOpacity()),this.options.interactive&&(L.DomUtil.addClass(this._rawImage,"leaflet-interactive"),this.addInteractiveTarget(this._rawImage)),e.on("zoomend resetview",this._reset,this),this.getPane().appendChild(this._image),this._reset()},onRemove:function(e){e.off("zoomend resetview",this._reset,this),L.ImageOverlay.prototype.onRemove.call(this,e)},_initImage:function(){var e=this._rawImage;this._url&&((e=L.DomUtil.create("img")).style.display="none",this.options.crossOrigin&&(e.crossOrigin=""),e.src=this._url,this._rawImage=e),L.DomUtil.addClass(e,"leaflet-image-layer");var t=this._image=L.DomUtil.create("div","leaflet-image-layer "+(this._zoomAnimated?"leaflet-zoom-animated":""));t.appendChild(e),t.onselectstart=L.Util.falseFn,t.onmousemove=L.Util.falseFn,e.onload=function(){this._reset(),e.style.display="block",this.fire("load")}.bind(this),e.alt=this.options.alt},_reset:function(){var e=this._image;if(this._map){var t=this._map.latLngToLayerPoint(this._topLeft),i=this._map.latLngToLayerPoint(this._topRight),s=this._map.latLngToLayerPoint(this._bottomLeft),a=i.subtract(t).add(s),n=L.bounds([t,i,s,a]),r=n.getSize(),o=t.subtract(n.min);this._bounds=L.latLngBounds(this._map.layerPointToLatLng(n.min),this._map.layerPointToLatLng(n.max)),L.DomUtil.setPosition(e,n.min),e.style.width=r.x+"px",e.style.height=r.y+"px";var l=this._rawImage.width,c=this._rawImage.height;if(l&&c){var h=i.subtract(t),d=s.subtract(t);this._rawImage.style.transformOrigin="0 0",this._rawImage.style.transform="matrix("+h.x/l+", "+h.y/l+", "+d.x/c+", "+d.y/c+", "+o.x+", "+o.y+")"}}},reposition:function(e,t,i){this._topLeft=L.latLng(e),this._topRight=L.latLng(t),this._bottomLeft=L.latLng(i),this._reset()},setUrl:function(e){return this._url=e,this._rawImage&&(this._rawImage.src=e),this}}),L.imageOverlay.rotated=function(e,t,i,s,a,n){return new L.ImageOverlay.Rotated(e,t,i,s,a,n)};var s=L.imageOverlay.rotated;var a=class{constructor(){this.$levelSwitcher=document.querySelector("#lvl-switch"),this.$levelUp=this.$levelSwitcher.querySelector("#lvl-up"),this.$levelDown=this.$levelSwitcher.querySelector("#lvl-down"),this.$levelLabel=this.$levelSwitcher.querySelector("#lvl-lable")}show(){this.$levelSwitcher.classList.add("show")}hide(){this.$levelSwitcher.classList.remove("show")}setLevel(e){this.$levelLabel.innerText=e}};var n=class{constructor(e){if(!(e instanceof L.Map))throw TypeError();this._map=e,this.currentBuilding,this.currentLevel,this.levels={},this.view=new a,this.setupHandlers()}setupHandlers(){return this.switchUpHandler=this.switchUp.bind(this),this.switchDownHandler=this.switchDown.bind(this),this}enable(){this.view.$levelUp.addEventListener("click",this.switchUpHandler),this.view.$levelDown.addEventListener("click",this.switchDownHandler)}disable(){this.view.$levelUp.removeEventListener("click",this.switchUpHandler),this.view.$levelDown.removeEventListener("click",this.switchDownHandler)}createBuildingLevels(e){for(let i in e.levels){var t=s(this._map,e.levels[i],e._corners.topLeft,e._corners.topRight,e._corners.bottomLeft,{interactive:!1,opacity:0});this.levels[i]=t,t.addTo(this._map),e.defaultLevel==i&&t.setOpacity(1)}}selectBuilding(e){this.currentBuilding&&this.currentBuilding.id===e.id||(this.currentBuilding=e,this.currentLevel=e.defaultLevel,this.createBuildingLevels(e),this.enable(),this.view.show(),this.view.setLevel(e.defaultLevel))}unselectBuilding(){void 0!==this.currentBuilding&&(Object.values(this.levels).forEach(e=>e.remove()),this.currentBuilding=void 0,this.currentLevel=void 0,this.levels={},this.disable(),this.view.hide(),this.view.setLevel(""))}switchLevel(e){var t=this.currentLevel+e;if(t>=0&&void 0!==this.levels[t]){var i=this.currentLevel;this.currentLevel=t,this.levels[i].setOpacity(0),this.levels[this.currentLevel].setOpacity(1),this.view.setLevel(t)}}switchUp(){this.switchLevel(1)}switchDown(){this.switchLevel(-1)}hasSelectedBuilding(){return void 0!==this.currentBuilding}};var r=class{constructor(e,t){this._map=t,this.buildings=e,this.masterBuildingsLayer=new L.FeatureGroup([]),this.levelsSwitcher=new n(this._map),this.masterBuildingsLayer.addTo(this._map),this.enable().renderBuildingsContours(this.buildings)}setupHandlers(){}enable(){return this._map.on("moveend zoomend",()=>{var e=this._map.getBounds().getCenter(),t=this.masterBuildingsLayer.getLayers().find(t=>t.getBounds().contains(e));t&&this._map.getZoom()>=18?this.levelsSwitcher.selectBuilding(this.buildings[t._customId]):this.levelsSwitcher.hasSelectedBuilding()&&this.levelsSwitcher.unselectBuilding()}),this}renderBuildingsContours(){return(this.buildings instanceof Array?this.buildings:Object.values(this.buildings)).forEach(e=>{var t=s(this._map,e._contour,e._corners.topLeft,e._corners.topRight,e._corners.bottomLeft,{interactive:!0});t._customId=e.id,this.masterBuildingsLayer.addLayer(t)}),this}},o=i.p+"./media/2f603016ed222282cd1d94c081440e5f.svg";const l={building_0x12idww:{id:"building_0x12idww",building:"A",defaultLevel:6,levels:{6:i.p+"./media/82a3966ef63ddd70295d914e4b93976f.svg",7:i.p+"./media/ea2dd2aee1156c9bd8409a8468c355c7.svg",8:i.p+"./media/dcac02582fafc95b19b8dfaeed17d369.svg"},_contour:o,_corners:{topLeft:{lat:43.02507858514359,lng:131.8935137987137},topRight:{lat:43.02479622315571,lng:131.89463496208194},bottomLeft:{lat:43.02421869798665,lng:131.8931120321577}}}};function c(){this._map,this._masterPlacesLayers={},this._masterBuildingsLayers=new L.LayerGroup,this.init(),this.bildingsController=new r(l,this._map)}c.prototype={init:function(){this._map=L.map("mapid",{zoomControl:!1,minZoom:16,maxZoom:20}).setView([43.02450002995938,131.89426848759467],13).setMaxBounds([[43.050952,131.85915],[42.994509,131.94232]]),L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{minZoom:16,maxZoom:19,attribution:'&copy; <a href="https://openstreetmap.org/copyright">OpenStreetMap contributors</a>'}).addTo(this._map)},addPlacesLayers:function(e){e instanceof Array||(e=Object.values(e)),e.forEach(e=>{this.addPlacesLayer(e)})},addPlacesLayer:function(e){var t=L.geoJSON([],{onEachFeature:(e,t)=>{t._leaflet_id=e.properties.id,t.state="inactive",t.options.icon=L.icon({iconUrl:`/media/placesicons/${e.properties.icon||"default"}.svg`,iconSize:[20,20],iconAnchor:[10,10],popupAnchor:[0,0]}),t.setLatLng(e.geometry.coordinates),t.on("click",e=>{console.log("click on place")})}});this._masterPlacesLayers[e.id]=t,"active"===e.state&&t.addTo(this._map)},addPlaces:function(e,t){e instanceof Array||(e=Object.values(e)),e.forEach(e=>{this.addPlaces(e,t)})},addPlace:function(e,t){const i={type:"Feature",geometry:{type:"Point",coordinates:[e.latlng.lat,e.latlng.lng]},properties:{id:e.id,icon:e.icon||"default"}};this._masterPlacesLayer.getLayer(t).addData(i)},addBuilding:function(e){},showLayer:function(e){const t=this._masterPlacesLayers[e];t&&!this._map.hasLayer(t)&&t.addTo(this._map)},hideLayer:function(e){const t=this._masterPlacesLayers[e];t&&this._map.hasLayer(t)&&this._map.removeLayer(t)}};var h=c,d=i.p+"./media/17a3829ed24e43f028917d83fe147de8.svg";var u=class{constructor(){this.$messageBtn=document.querySelector(".btns-group #message-btn")}createMsgBlockHTML(){return`\n            <div class="message-block">\n                <div class="message-block__container shadow">\n                    <div class="writable-message">\n                        <textarea name="mess" \n                            id="mess" \n                            onlyread="false" \n                            placeholder="Введите сообщение" \n                            maxlength="110" \n                            cols="30" rows="1"></textarea>\n                        <div class="user-btn user-btn--small shadow">\n                            <img src="${d}" alt="">\n                        </div>\n                    </div>\n                </div>\n            </div>`}async renderMsgBlock(e){await document.querySelector(".app .main .container").insertAdjacentHTML("beforeend",e),this.$messageBlock=document.querySelector(".message-block"),this.$sendMessageBtn=this.$messageBlock.querySelector(".user-btn"),setTimeout(()=>{this.$messageBlock.classList.add("show")},100)}removeMsgBlock(){try{this.$messageBlock.classList.remove("show"),setTimeout(()=>{this.$messageBlock.parentNode.removeChild(this.$messageBlock),this.$messageBlock=void 0,this.$sendMessageBtn=void 0},300)}catch(e){console.error(e)}}getValuerFromInput(){return this.$messageBlock.querySelector("textarea").value}showMarker(){this.$centeredMarker=document.querySelector(".centered-marker"),this.$centeredMarker.classList.add("show")}hideMarker(){this.$centeredMarker.classList.remove("show"),this.$centeredMarker=void 0}},m=i(0);var p=class{constructor(){this._cookieName="nextmsgsndg",this.view=new u,this.enable(),this.clickHandler=e=>this.close(),this.dragHandler=e=>e.stopPropagation(),this.notifyEvent=new m.a}enable(){return this.view.$messageBtn.addEventListener("click",e=>{e.stopPropagation(),this.open()}),this}enableChatListeners(){this.view.$sendMessageBtn.addEventListener("click",e=>{e.stopPropagation();var t=this.view.getValuerFromInput();this.sendMessage(t)},{once:!0}),this.view.$messageBlock.addEventListener("click",e=>{e.stopPropagation()}),document.addEventListener("drag",this.dragHandler),document.addEventListener("click",this.clickHandler,{once:!0})}open(){var e=this.view.createMsgBlockHTML();this.view.showMarker(),this.view.renderMsgBlock(e).then(()=>this.enableChatListeners())}close(){this.view.removeMsgBlock(),this.view.hideMarker(),document.removeEventListener("drag",this.dragHandler),document.removeEventListener("click",this.clickHandler)}sendMessage(e){const t=this._getCookie(this._cookieName);if(e.length>5&&void 0===t)this._writeCookie(),this.close(),this.notifyEvent.notify("user-notification",e);else if(void 0!==t){var i=new Date(t)-(new Date).getTime();this.close(),this.notifyEvent.notify("system-notification","Отправка сообщений будет доступна через: "+this._msToTime(i))}}_msToTime(e){parseInt(e%1e3/100);var t=Math.floor(e/1e3%60);return Math.floor(e/6e4%60)+"мин "+(t=t<10?"0"+t:t)+"с."}_writeCookie(){var e=new Date;e.setTime(e.getTime()+3e5);var t="; expires="+e.toUTCString();document.cookie=this._cookieName+"="+e+t+"; path=/"}_getCookie(e){const t=("; "+document.cookie).split(`; ${e}=`);if(2===t.length)return t.pop().split(";").shift()}};console.log(function(e){if(e&&"string"==typeof e)return e+"_"+Math.random().toString(36).substr(2,9)}("place"));const v=JSON.stringify({placesLayer_pe73zbwun:{id:"placesLayer_pe73zbwun",title:"Поесть",icon:"canteen.svg",places:{}},placesLayer_0bfeky7y6:{id:"placesLayer_0bfeky7y6",title:"Покупки",icon:"buy.svg",places:{}},placesLayer_7j2i7g4ca:{id:"placesLayer_7j2i7g4ca",title:"Банки и Банкоматы",icon:"credit-card.svg",places:{}},placesLayer_b821zcztt:{id:"placesLayer_b821zcztt",title:"Медицина",icon:"pharmacy.svg",places:{}},placesLayer_ncx52mogj:{id:"placesLayer_ncx52mogj",title:"Услуги",icon:"services.svg",places:{}},placesLayer_oanemea8a:{id:"placesLayer_oanemea8a",title:"Копи. центры",icon:"printer.svg",places:{}}});function g(){this._placesLayers={},this._buildingsLayers={}}g.prototype={loadPlacesLayers:async function(){const e=await v;return this._placesLayers=await JSON.parse(e),this._placesLayers},loadBuildingsLayers:async function(){},getPlacesLayer:function(e){return this._placesLayers[e]},getPlacesLayers:function(){return this._placesLayers},getPlace:function(e,t){return this.getPlacesLayer(e)[t]},getBuilding:function(){}};var f=g,y=i(1);var _=class{constructor(e){this._map=e,this.$geolocationBtn=document.querySelector("#location-btn"),this.enable(),this.notifyEvent=new m.a}enable(){this._map.on("locationfound",e=>{this._map.getBounds().contains(e.bounds)?this.locate(e.latlng):this.throwLocationErrorNotification("Вы находитесь вне территории кампуса ДВФУ")}),this._map.on("locationerror",e=>{this.throwLocationErrorNotification("Возникла ошибка при опеределении вашей геопозиции")}),this.$geolocationBtn.addEventListener("click",this.getLocation.bind(this))}getLocation(){this._map.locate({setView:!1})}locate(e){this._map.setView(e,18),this.showLocationByMarker(e)}showLocationByMarker(e){var t=new L.Marker(e,{icon:new L.Icon({iconUrl:y.a,iconSize:[30,30],iconAnchor:[15,15]}),draggable:!1});t.addTo(this._map),document.addEventListener("click",()=>t.remove(),{once:!0})}throwLocationErrorNotification(e){this.notifyEvent.notify("system-notification",e)}};var w=class{constructor(){this.$notificationsBlock=document.querySelector(".notifications")}print(e){this._clear(),this.$notificationsBlock.insertAdjacentHTML("beforeend",`<div class="notification ${e.type}">${e.value}</div>`),this._enable()}_enable(){document.addEventListener("click",this._clear.bind(this),{once:!0})}_clear(){Array.from(this.$notificationsBlock.children).forEach(e=>{e.classList.add("hide"),setTimeout(()=>e&&e.parentNode===this.$notificationsBlock?this.$notificationsBlock.removeChild(e):void 0,300)})}};var b=class{constructor(e,t){if("user-notification"!==e&&"system-notification"!==e)throw new TypeError("Неверный тип оповещений: "+e);this.type=e,this.value=t}};function k(){this.map=new h,this.userChat=new p,this.mapObjects=new f,this.geolocation=new _(this.map._map),this.notificationsPrinter=new w,this.setupHandlers().enable()}window.addEventListener("load",e=>{const t=document.querySelector(".preloader");t.classList.add("preloader--out"),setTimeout(()=>{t.parentElement.removeChild(t)},1e3)}),k.prototype={setupHandlers(){return this.printNotificationHandler=this.printNotification.bind(this),this},enable(){return this.geolocation.notifyEvent.attach(this.printNotificationHandler),this.userChat.notifyEvent.attach(this.printNotificationHandler),this},printNotification(e,t){this.notificationsPrinter.print(new b(e,t))},enaleMessagesLayer(){new L.LayerGroup([])},renderPlacesLayers:function(e){e instanceof Array||(e=Object.values(e));const t=JSON.parse(localStorage.getItem("layers"))||{};t!=={}?e.forEach(e=>{t.hasOwnProperty(e.id)?e.state=t[e.id]:(e.state="active",t[e.id]="active")}):e.forEach(e=>{e.state="active",t[e.id]="active"}),localStorage.removeItem("layers"),localStorage.setItem("layers",JSON.stringify(t)),this.leftSidebar.renderLayersItems(e),this.map.addPlacesLayers(e)},toggleLayerVisibility:function(e,t){const i=JSON.parse(localStorage.getItem("layers"));switch(i[e]=t,t){case"active":this.map.showLayer(e);break;case"disable":this.map.hideLayer(e)}localStorage.removeItem("layers"),localStorage.setItem("layers",JSON.stringify(i))}},new k}]);